<?xml version="1.0"?>

<!--
  Copyright (C) Igor Sysoev
  Copyright (C) Nginx, Inc.
  -->

<!DOCTYPE module SYSTEM "../../../../dtd/module.dtd">

<module name="Module ngx_http_charset_module"
        link="/en/docs/http/ngx_http_charset_module.html"
        lang="cn"
        translator="allisstone"
        rev="1">

<section id="summary">

<para>
 <literal>ngx_http_charset_module</literal>模块为 
<header>Content-Type</header> 响应头域添加了指定字符集。
此外，模块可以将数据从一个字符集转换到另外一个，局限在于：
<list type="bullet">

<listitem>
转换以从服务器到客户端的方式单向执行。
</listitem>

<listitem>
只有单字节字符集可以转换。
</listitem>

<listitem>
或单字节字符集转化为或转化自UTF-8。
</listitem>

</list>
</para>

</section>


<section id="example" name="Example Configuration">

<para>
<example>
include        conf/koi-win;

charset        windows-1251;
source_charset koi8-r;
</example>
</para>

</section>


<section id="directives" name="Directives">

<directive name="charset">
<syntax><value>charset</value> | <literal>off</literal></syntax>
<default>off</default>
<context>http</context>
<context>server</context>
<context>location</context>
<context>if in location</context>

<para>
为<header>Content-Type</header>
响应头域增加指定字符集。如果这个字符集与在
<link id="source_charset"/> 指令中指定的字符集不同，那么一个转化就被执行。
</para>

<para>
参数<literal>off</literal> 取消添加到
<header>Content-Type</header> 响应头域的字符集。
</para>

<para>
字符集可以用一个变量来定义：
<example>
charset $charset;
</example>
在这样的情况下，一个变量的所有可能值都必须以
<link id="charset_map"/>, <link id="charset"/>, 或
<link id="source_charset"/> 指令的形式，至少在配置中出现一次。
对于<literal>utf-8</literal>, <literal>windows-1251</literal>, 和
<literal>koi8-r</literal> 字符集来说，足够将文件
<path>conf/koi-win</path>, <path>conf/koi-utf</path>, 和
<path>conf/win-utf</path> 导入到配置中。
对于其它字符集来说，简单做一个虚转表就能运转。例如：
<example>
charset_map iso-8859-5 _ { }
</example>
</para>

<para>
除此之外，字符集也可以在
<header>X-Accel-Charset</header> 响应头域设置。
可以使用
<link doc="ngx_http_proxy_module.xml" id="proxy_ignore_headers"/>
和
<link doc="ngx_http_fastcgi_module.xml" id="fastcgi_ignore_headers"/>
指令来禁用此功能。
</para>

</directive>


<directive name="charset_map">
<syntax block="yes"><value>charset1</value> <value>charset2</value></syntax>
<default/>
<context>http</context>

<para>
描述了一个从一个到另一个字符集的转换表。
反向转换表使用相同的数据建立。
字符代码使用16进制显示。
在范围80-FF之间缺少的字符用 “<literal>?</literal>”.来替换。
从UTF-8转换的时候，在一个字节的字符集丢失的字符用
“<literal>&amp;#XXXX;</literal>”.来代替。
</para>

<para>
Example:
<example>
charset_map koi8-r windows-1251 {
    C0 FE ; # small yu
    C1 E0 ; # small a
    C2 E1 ; # small b
    C3 F6 ; # small ts
    ...
}
</example>
</para>

<para>
当描述一个转换为UTF-8的转换表时，应当在第二列给出UTF-8的字符集的编码，例如：
<example>
charset_map koi8-r utf-8 {
    C0 D18E ; # small yu
    C1 D0B0 ; # small a
    C2 D0B1 ; # small b
    C3 D186 ; # small ts
    ...
}
</example>
</para>

<para>
从 <literal>koi8-r</literal> 到
<literal>windows-1251</literal>, 和从 <literal>koi8-r</literal> 和
<literal>windows-1251</literal> 到<literal>utf-8</literal>
的全转换表由分发文件 <path>conf/koi-win</path>,
<path>conf/koi-utf</path>, 和 <path>conf/win-utf</path>提供。
</para>

</directive>


<directive name="charset_types">
<syntax><value>mime-type</value> ...</syntax>
<default>text/html text/xml text/plain text/vnd.wap.wml
application/x-javascript application/rss+xml</default>
<context>http</context>
<context>server</context>
<context>location</context>
<appeared-in>0.7.9</appeared-in>

<para>
使用除了
“<literal>text/html</literal>”类型外的指定MIME类型来响应处理模块。
指定值“<literal>*</literal>” 通配任意MIME类型(0.8.29)。
</para>

</directive>


<directive name="override_charset">
<syntax><literal>on</literal> | <literal>off</literal></syntax>
<default>off</default>
<context>http</context>
<context>server</context>
<context>location</context>
<context>if in location</context>

<para>
对于收到来自代理服务器或者FastCGI服务器的应答是否转换，
决定于应答是否在<header>Content-Type</header>
响应头域携带了一个字符集。
如果执行转换，一个指定在接收响应里的字符集应被当作源字符集。
<note>
需要注意的是，如果在子请求中收到响应，那么都应该执行从主请求字符集到响应字符集的转换，
而不用理会<literal>override_charset</literal>
的指令设置。
</note>
</para>

</directive>


<directive name="source_charset">
<syntax><value>charset</value></syntax>
<default/>
<context>http</context>
<context>server</context>
<context>location</context>
<context>if in location</context>

<para>
定义一个响应的源字符集。
如果此字符集不同与
<link id="charset"/> 
指令的指定字符集，那么一个转换会被执行。
</para>

</directive>

</section>

</module>
